/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /gh/Qwabhina/qmgrid@master/qmgrid.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/**
 * QMGrid - A lightweight, feature-rich data table library
 * 
 * @fileoverview QMGrid is a comprehensive data table solution built with vanilla JavaScript.
 * It provides advanced features including sorting, filtering, pagination, row selection,
 * comprehensive export functionality (CSV, Excel, PDF, Print), and native server-side processing
 * support with zero dependencies.
 * 
 * @version 2.1.0
 * @author Qwabhina McFynn
 * @license MIT
 * @since 1.0.0
 * 
 * @example
 * // Basic usage
 * const grid = new QMGrid('#my-table', {
 *     data: myData,
 *     columns: [
 *         { key: 'name', title: 'Name' },
 *         { key: 'email', title: 'Email' }
 *     ]
 * });
 * 
 * @example
 * // Server-side processing
 * const grid = new QMGrid('#server-table', {
 *     columns: myColumns,
 *     serverSide: true,
 *     ajax: {
 *         url: '/api/data',
 *         method: 'POST'
 *     }
 * });
 * 
 * @example
 * // Advanced usage with export
 * const grid = new QMGrid('#advanced-table', {
 *     data: myData,
 *     columns: myColumns,
 *     exportable: true,
 *     selectable: true,
 *     searchable: true
 * });
 */
const DEFAULTS={PAGE_SIZE:10,SEARCH_DEBOUNCE_DELAY:300,PAGINATION_DELTA:2,MAX_VISIBLE_PAGES:7,SERVER_TIMEOUT:3e4,MAX_RETRY_ATTEMPTS:3,RETRY_DELAY:1e3},CSS_CLASSES={CONTAINER:"qmgrid-container",TABLE:"qmgrid-table",HEADER:"qmgrid-head",BODY:"qmgrid-body",ROW:"qmgrid-row",CELL:"qmgrid-cell",SORTABLE:"sortable",SELECTED:"selected",LOADING:"qmgrid-loading",EMPTY:"qmgrid-empty"},EVENTS={SEARCH:"search",SORT:"sort",PAGE_CHANGE:"pageChange",ROW_SELECT:"rowSelect",DATA_CHANGE:"dataChange",ROW_ADD:"rowAdd",ROW_REMOVE:"rowRemove",ROW_UPDATE:"rowUpdate",EXPORT:"export",SERVER_REQUEST_START:"serverRequestStart",SERVER_REQUEST_END:"serverRequestEnd",SERVER_ERROR:"serverError",SERVER_DATA_LOADED:"serverDataLoaded"},EXPORT_FORMATS={CSV:"csv",EXCEL:"excel",PDF:"pdf",PRINT:"print"};class QMGrid{constructor(e,t={}){if(!e)throw new Error("Selector is required");if(this.container="string"==typeof e?document.querySelector(e):e,!this.container)throw new Error(`Container element not found: ${e}`);this.config={data:[],columns:[],pagination:!0,pageSize:DEFAULTS.PAGE_SIZE,sortable:!0,filterable:!0,searchable:!0,selectable:!1,multiSelect:!1,responsive:!0,striped:!0,bordered:!0,hover:!0,loading:!1,emptyMessage:"No data available",exportable:!0,theme:"light",serverSide:!1,ajax:{url:null,method:"GET",headers:{},timeout:DEFAULTS.SERVER_TIMEOUT,retryAttempts:DEFAULTS.MAX_RETRY_ATTEMPTS,retryDelay:DEFAULTS.RETRY_DELAY,data:null,beforeSend:null,complete:null,error:null},serverResponse:{data:"data",totalRecords:"total",error:"error",draw:"draw"},exportOptions:{filename:"qmgrid-export",includeHeaders:!0,selectedOnly:!1,visibleOnly:!1,dateFormat:"YYYY-MM-DD",csvSeparator:",",pdfOrientation:"portrait",pdfPageSize:"A4",excelSheetName:"Data"},language:{search:"Search:",lengthMenu:"Show _MENU_ entries",info:"Showing _START_ to _END_ of _TOTAL_ entries",infoEmpty:"Showing 0 to 0 of 0 entries",infoFiltered:"(filtered from _MAX_ total entries)",paginate:{first:"First",previous:"Previous",next:"Next",last:"Last"},export:{csv:"Export CSV",excel:"Export Excel",pdf:"Export PDF",print:"Print Table"}},...t},this.currentPage=1,this.sortColumn=null,this.sortDirection="asc",this.searchTerm="",this.selectedRows=new Set,this.filteredData=[],this.originalData=[],this.searchTimeout=null,this.eventListeners=new Map,this.events={},this.totalRecords=0,this.isLoading=!1,this.currentRequest=null,this.requestId=0,this.retryCount=0,this.init()}init(){if(this.config.serverSide){if(!this.config.ajax.url)throw new Error("Server-side processing enabled but no URL provided in ajax.url");this.originalData=[],this.filteredData=[],this.totalRecords=0}else this.originalData=[...this.config.data],this.filteredData=[...this.config.data];this.createStructure(),this.config.serverSide?this.loadServerData():this.render(),this.attachEvents()}createStructure(){this.container.className=CSS_CLASSES.CONTAINER,this.setTheme(this.config.theme),this.container.innerHTML=`\n            <div class="qmgrid-header">\n                <div class="qmgrid-controls">\n                    <div class="qmgrid-length">\n                        <label>\n                            ${this.config.language.lengthMenu.replace("_MENU_",`\n                                <select class="page-size-select">\n                                    <option value="5">5</option>\n                                    <option value="10" ${10===this.config.pageSize?"selected":""}>10</option>\n                                    <option value="25" ${25===this.config.pageSize?"selected":""}>25</option>\n                                    <option value="50" ${50===this.config.pageSize?"selected":""}>50</option>\n                                    <option value="100" ${100===this.config.pageSize?"selected":""}>100</option>\n                                </select>\n                            `)}\n                        </label>\n                    </div>\n                    ${this.config.searchable?`\n                        <div class="qmgrid-search">\n                            <label>\n                                ${this.config.language.search}\n                                <input type="search" class="search-input" placeholder="Search..." \n                                       aria-label="Search table data" autocomplete="off">\n                            </label>\n                        </div>\n                    `:""}\n                    ${this.config.exportable?`\n                        <div class="qmgrid-export">\n                            <div class="export-dropdown">\n                                <button class="export-btn" aria-label="Export options">\n                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">\n                                        <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>\n                                    </svg>\n                                    Export\n                                </button>\n                                <div class="export-menu">\n                                    <button class="export-option" data-format="csv">${this.config.language.export.csv}</button>\n                                    <button class="export-option" data-format="excel">${this.config.language.export.excel}</button>\n                                    <button class="export-option" data-format="pdf">${this.config.language.export.pdf}</button>\n                                    <button class="export-option" data-format="print">${this.config.language.export.print}</button>\n                                </div>\n                            </div>\n                        </div>\n                    `:""}\n                </div>\n            </div>\n            <div class="qmgrid-wrapper">\n                <table class="qmgrid-table ${this.getTableClasses()}" role="table" aria-label="Data table">\n                    <thead class="qmgrid-head" role="rowgroup"></thead>\n                    <tbody class="qmgrid-body" role="rowgroup"></tbody>\n                </table>\n                <div class="qmgrid-loading" style="display: none;" role="status" aria-live="polite">\n                    <div class="loading-spinner"></div>\n                    <span>Loading...</span>\n                </div>\n                <div class="qmgrid-empty" style="display: none;" role="status" aria-live="polite">\n                    ${this.config.emptyMessage}\n                </div>\n            </div>\n            ${this.config.pagination?`\n                <div class="qmgrid-footer">\n                    <div class="qmgrid-info"></div>\n                    <div class="qmgrid-pagination">\n                        <button class="page-btn first-page" title="${this.config.language.paginate.first}">&laquo;</button>\n                        <button class="page-btn prev-page" title="${this.config.language.paginate.previous}">&lsaquo;</button>\n                        <div class="page-numbers"></div>\n                        <button class="page-btn next-page" title="${this.config.language.paginate.next}">&rsaquo;</button>\n                        <button class="page-btn last-page" title="${this.config.language.paginate.last}">&raquo;</button>\n                    </div>\n                </div>\n            `:""}\n        `}getTableClasses(){const e=[];return this.config.striped&&e.push("table-striped"),this.config.bordered&&e.push("table-bordered"),this.config.hover&&e.push("table-hover"),this.config.responsive&&e.push("table-responsive"),e.join(" ")}setTheme(e){"light"!==e&&"dark"!==e&&(console.warn(`QMGrid: Invalid theme '${e}'. Using 'light' theme.`),e="light"),this.config.theme=e,"dark"===e?this.container.classList.add("qmgrid-dark"):this.container.classList.remove("qmgrid-dark")}getTheme(){return this.config.theme}toggleTheme(){const e="light"===this.config.theme?"dark":"light";this.setTheme(e)}render(){this.renderHeader(),this.renderBody(),this.config.pagination&&(this.renderPagination(),this.renderInfo())}renderHeader(){const e=this.container.querySelector(".qmgrid-head"),t=document.createElement("tr");if(this.config.selectable){const e=document.createElement("th");e.className="select-column",this.config.multiSelect&&(e.innerHTML='<input type="checkbox" class="select-all-checkbox">'),t.appendChild(e)}this.config.columns.forEach((e=>{const i=document.createElement("th");i.className="qmgrid-header-cell",i.textContent=e.title,e.width&&(i.style.width=e.width),this.config.sortable&&!1!==e.sortable&&(i.classList.add("sortable"),i.dataset.column=e.key,i.setAttribute("tabindex","0"),i.setAttribute("role","button"),i.setAttribute("aria-sort","none")),t.appendChild(i)})),e.innerHTML="",e.appendChild(t)}renderBody(){const e=this.container.querySelector(".qmgrid-body"),t=this.container.querySelector(".qmgrid-empty");if(0===this.filteredData.length)return e.innerHTML="",void(t.style.display="block");let i,n;if(t.style.display="none",this.config.serverSide)i=this.filteredData,n=(this.currentPage-1)*this.config.pageSize,console.log("Server-side renderBody:",{currentPage:this.currentPage,pageSize:this.config.pageSize,filteredDataLength:this.filteredData.length,startIndex:n,pageDataLength:i.length});else{n=this.config.pagination?(this.currentPage-1)*this.config.pageSize:0;const e=this.config.pagination?n+this.config.pageSize:this.filteredData.length;i=this.filteredData.slice(n,e)}e.innerHTML="",i.forEach(((t,i)=>{const s=document.createElement("tr");if(s.className="qmgrid-row",s.dataset.index=n+i,this.selectedRows.has(n+i)&&s.classList.add("selected"),this.config.selectable){const e=document.createElement("td");e.className="select-column";const t=document.createElement("input");t.type=this.config.multiSelect?"checkbox":"radio",t.name=this.config.multiSelect?"":"row-select",t.className="row-select-checkbox",t.checked=this.selectedRows.has(n+i),e.appendChild(t),s.appendChild(e)}this.config.columns.forEach((e=>{const r=document.createElement("td");r.className="qmgrid-cell";let a=this.getCellValue(t,e.key);if(e.render&&"function"==typeof e.render)a=this.safeRender(e.render,a,t,n+i);else if("date"===e.type&&a)try{a=new Date(a).toLocaleDateString()}catch(e){console.warn("Invalid date value:",a),a=String(a)}else if("currency"===e.type&&null!=a)try{const e=parseFloat(a);a=isNaN(e)?String(a):new Intl.NumberFormat("en-US",{style:"currency",currency:"GHS"}).format(e)}catch(e){console.warn("Invalid currency value:",a),a=String(a)}r.innerHTML=a||"",e.className&&(r.className+=" "+e.className),s.appendChild(r)})),e.appendChild(s)}))}getCellValue(e,t){return e&&"object"==typeof e&&t?t.includes(".")?t.split(".").reduce(((e,t)=>e&&void 0!==e[t]?e[t]:""),e):void 0!==e[t]&&null!==e[t]?e[t]:"":""}safeRender(e,t,i,n){try{const s=e(t,i,n);return"string"!=typeof s&&"number"!=typeof s?(console.warn("Render function should return string or number, got:",typeof s),String(s||"")):s}catch(e){return console.error("Error in custom render function:",e),String(t||"")}}renderPagination(){const e=this.config.serverSide?Math.ceil(this.totalRecords/this.config.pageSize):Math.ceil(this.filteredData.length/this.config.pageSize),t=this.container.querySelector(".qmgrid-pagination");if(!t)return;const i=t.querySelector(".page-numbers"),n=t.querySelector(".first-page"),s=t.querySelector(".prev-page"),r=t.querySelector(".next-page"),a=t.querySelector(".last-page");if(n&&(n.disabled=1===this.currentPage),s&&(s.disabled=1===this.currentPage),r&&(r.disabled=this.currentPage===e||0===e),a&&(a.disabled=this.currentPage===e||0===e),i)if(i.innerHTML="",e<=DEFAULTS.MAX_VISIBLE_PAGES)for(let t=1;t<=e;t++)i.appendChild(this.createPageButton(t));else{i.appendChild(this.createPageButton(1)),this.currentPage>4&&i.appendChild(this.createEllipsis());const t=Math.max(2,this.currentPage-DEFAULTS.PAGINATION_DELTA),n=Math.min(e-1,this.currentPage+DEFAULTS.PAGINATION_DELTA);for(let e=t;e<=n;e++)i.appendChild(this.createPageButton(e));this.currentPage<e-3&&i.appendChild(this.createEllipsis()),e>1&&i.appendChild(this.createPageButton(e))}}createPageButton(e){const t=document.createElement("button");return t.className="page-btn page-number",t.textContent=e,t.dataset.page=e,e===this.currentPage&&t.classList.add("active"),t}createEllipsis(){const e=document.createElement("span");return e.className="page-ellipsis",e.textContent="...",e}renderInfo(){const e=this.container.querySelector(".qmgrid-info");if(e)if(this.config.serverSide){const t=0===this.totalRecords?0:(this.currentPage-1)*this.config.pageSize+1,i=Math.min(this.currentPage*this.config.pageSize,this.totalRecords),n=this.totalRecords;let s;0===n?s=this.config.language.infoEmpty:(s=this.config.language.info.replace("_START_",t).replace("_END_",i).replace("_TOTAL_",n),this.searchTerm&&(s+=" "+this.config.language.infoFiltered.replace("_MAX_",n))),e.textContent=s}else{const t=0===this.filteredData.length?0:(this.currentPage-1)*this.config.pageSize+1,i=Math.min(this.currentPage*this.config.pageSize,this.filteredData.length),n=this.filteredData.length,s=this.originalData.length;let r;0===n?r=this.config.language.infoEmpty:(r=this.config.language.info.replace("_START_",t).replace("_END_",i).replace("_TOTAL_",n),n!==s&&(r+=" "+this.config.language.infoFiltered.replace("_MAX_",s))),e.textContent=r}}attachEvents(){if(this.config.searchable){const e=this.container.querySelector(".search-input");if(e){const t=this.debounce((e=>{this.search(e.target.value)}),DEFAULTS.SEARCH_DEBOUNCE_DELAY);e.addEventListener("input",t),this.eventListeners.set("search-input",{element:e,event:"input",handler:t})}}const e=this.container.querySelector(".page-size-select");if(e){const t=e=>{this.setPageSize(parseInt(e.target.value))};e.addEventListener("change",t),this.eventListeners.set("page-size",{element:e,event:"change",handler:t})}if(this.config.sortable){const e=e=>{const t=e.target.closest(".sortable");if(t){const e=t.dataset.column;this.sort(e)}};this.container.addEventListener("click",e),this.eventListeners.set("sort",{element:this.container,event:"click",handler:e})}if(this.config.selectable){const e=e=>{if(e.target.classList.contains("select-all-checkbox"))this.selectAll(e.target.checked);else if(e.target.classList.contains("row-select-checkbox")){const t=e.target.closest("tr");if(t){const i=parseInt(t.dataset.index);isNaN(i)||this.selectRow(i,e.target.checked)}}};this.container.addEventListener("change",e),this.eventListeners.set("selection",{element:this.container,event:"change",handler:e})}if(this.config.pagination){const e=e=>{const t=this.config.serverSide?Math.ceil(this.totalRecords/this.config.pageSize):Math.ceil(this.filteredData.length/this.config.pageSize);if(this.config.serverSide&&e.target.classList.contains("page-number")&&console.log("Server-side pagination:",{totalRecords:this.totalRecords,pageSize:this.config.pageSize,totalPages:t,clickedPage:parseInt(e.target.dataset.page)}),e.target.classList.contains("first-page"))this.goToPage(1);else if(e.target.classList.contains("prev-page"))this.goToPage(Math.max(1,this.currentPage-1));else if(e.target.classList.contains("next-page"))this.goToPage(Math.min(t,this.currentPage+1));else if(e.target.classList.contains("last-page"))this.goToPage(t);else if(e.target.classList.contains("page-number")){const i=parseInt(e.target.dataset.page);!isNaN(i)&&i>=1&&i<=t?this.goToPage(i):console.warn("Invalid page number:",i,"Total pages:",t)}};this.container.addEventListener("click",e),this.eventListeners.set("pagination",{element:this.container,event:"click",handler:e})}if(this.config.exportable){const e=e=>{if(e.target.classList.contains("export-btn")){e.preventDefault();e.target.nextElementSibling.classList.toggle("show")}else if(e.target.classList.contains("export-option")){e.preventDefault();const t=e.target.dataset.format;this.exportData(t);e.target.closest(".export-menu").classList.remove("show")}};this.container.addEventListener("click",e),this.eventListeners.set("export",{element:this.container,event:"click",handler:e});const t=e=>{if(!e.target.closest(".export-dropdown")){this.container.querySelectorAll(".export-menu").forEach((e=>e.classList.remove("show")))}};document.addEventListener("click",t),this.eventListeners.set("export-outside",{element:document,event:"click",handler:t})}}debounce(e,t){return(...i)=>{clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout((()=>e.apply(this,i)),t)}}search(e){return"string"!=typeof e&&(e=String(e||"")),this.searchTerm=e.toLowerCase(),this.config.serverSide?(this.currentPage=1,this.loadServerData()):(this.applyFilters(),this.currentPage=1,this.render()),this.emit(EVENTS.SEARCH,{term:e}),this}applyFilters(){this.filteredData=this.originalData.filter((e=>!this.searchTerm||this.config.columns.some((t=>{const i=this.getCellValue(e,t.key);return i&&i.toString().toLowerCase().includes(this.searchTerm)}))))}setData(e){if(!Array.isArray(e))throw new Error("Data must be an array");return this.config.serverSide&&(console.warn("setData() called with server-side processing enabled. This will switch to client-side mode for this data."),this.config.serverSide=!1),this.originalData=[...e],this.config.data=e,this.applyFilters(),this.currentPage=1,this.selectedRows.clear(),this.render(),this.emit(EVENTS.DATA_CHANGE,{data:e}),this}addRow(e){if(!e||"object"!=typeof e)throw new Error("Row must be an object");return this.config.serverSide?(console.warn("addRow() not supported in server-side mode. Use server API to add data."),this):(this.originalData.push(e),this.config.data.push(e),this.applyFilters(),this.render(),this.emit(EVENTS.ROW_ADD,{row:e}),this)}removeRow(e){if("number"!=typeof e||e<0||e>=this.originalData.length)return console.warn(`Invalid row index: ${e}`),this;if(this.config.serverSide)return console.warn("removeRow() not supported in server-side mode. Use server API to remove data."),this;const t=this.originalData.splice(e,1)[0];this.config.data.splice(e,1),this.selectedRows.delete(e);const i=new Set;return this.selectedRows.forEach((t=>{t>e?i.add(t-1):t<e&&i.add(t)})),this.selectedRows=i,this.applyFilters(),this.render(),this.emit(EVENTS.ROW_REMOVE,{row:t,index:e}),this}updateRow(e,t){if("number"!=typeof e||e<0||e>=this.originalData.length)return console.warn(`Invalid row index: ${e}`),this;if(!t||"object"!=typeof t)throw new Error("New data must be an object");return this.config.serverSide?(console.warn("updateRow() not supported in server-side mode. Use server API to update data."),this):(this.originalData[e]={...this.originalData[e],...t},this.config.data[e]={...this.config.data[e],...t},this.applyFilters(),this.render(),this.emit(EVENTS.ROW_UPDATE,{row:this.originalData[e],index:e}),this)}sort(e,t=null){if(!e||"string"!=typeof e)return console.warn("Sort column must be a non-empty string"),this;return this.config.columns.some((t=>t.key===e))?(t&&!["asc","desc"].includes(t)&&(console.warn('Sort direction must be "asc" or "desc"'),t=null),this.sortColumn===e&&null===t?this.sortDirection="asc"===this.sortDirection?"desc":"asc":(this.sortColumn=e,this.sortDirection=t||"asc"),this.config.serverSide?(this.currentPage=1,this.loadServerData()):(this.filteredData.sort(((t,i)=>{const n=this.getCellValue(t,e),s=this.getCellValue(i,e);let r=0;return n<s?r=-1:n>s&&(r=1),"desc"===this.sortDirection?-r:r})),this.render()),this.emit(EVENTS.SORT,{column:e,direction:this.sortDirection}),this):(console.warn(`Column '${e}' does not exist`),this)}goToPage(e){if(this.config.serverSide){const t=Math.ceil(this.totalRecords/this.config.pageSize);e>=1&&e<=t&&(this.currentPage=e,this.loadServerData(),this.emit(EVENTS.PAGE_CHANGE,{page:e}))}else{const t=Math.ceil(this.filteredData.length/this.config.pageSize);e>=1&&e<=t&&(this.currentPage=e,this.render(),this.emit(EVENTS.PAGE_CHANGE,{page:e}))}return this}setPageSize(e){return"number"!=typeof e||e<1?(console.warn("Page size must be a positive number"),this):(this.config.pageSize=e,this.currentPage=1,this.config.serverSide?this.loadServerData():this.render(),this.emit("pageSizeChange",{pageSize:e}),this)}selectRow(e,t){return this.config.multiSelect||this.selectedRows.clear(),t?this.selectedRows.add(e):this.selectedRows.delete(e),this.render(),this.emit(EVENTS.ROW_SELECT,{index:e,selected:t,selectedRows:Array.from(this.selectedRows)}),this}selectAll(e){return e?this.filteredData.forEach(((e,t)=>{this.selectedRows.add(t)})):this.selectedRows.clear(),this.render(),this.emit("selectAll",{selected:e,selectedRows:Array.from(this.selectedRows)}),this}getSelectedRows(){return Array.from(this.selectedRows).map((e=>this.filteredData[e])).filter(Boolean)}clearSelection(){return this.selectedRows.clear(),this.render(),this.emit("selectionClear"),this}showLoading(){const e=this.container.querySelector(".qmgrid-loading"),t=this.container.querySelector(".qmgrid-wrapper table");return e&&(e.style.display="flex"),t&&(t.style.opacity="0.5"),this}hideLoading(){const e=this.container.querySelector(".qmgrid-loading"),t=this.container.querySelector(".qmgrid-wrapper table");return e&&(e.style.display="none"),t&&(t.style.opacity="1"),this}async loadServerData(){if(this.config.ajax.url){if(this.currentRequest&&this.currentRequest.abort(),!this.isLoading){this.isLoading=!0,this.showLoading(),this.emit(EVENTS.SERVER_REQUEST_START,{page:this.currentPage,search:this.searchTerm,sort:this.sortColumn,direction:this.sortDirection});try{const e=++this.requestId,t={page:this.currentPage,pageSize:this.config.pageSize,search:this.searchTerm,sortBy:this.sortColumn,sortDir:this.sortDirection,draw:e},i=this.config.ajax.data?this.config.ajax.data(t):t;if(this.config.ajax.beforeSend&&"function"==typeof this.config.ajax.beforeSend){if(!1===this.config.ajax.beforeSend(i,t))return this.isLoading=!1,void this.hideLoading()}const n=new AbortController;this.currentRequest=n;const s={method:this.config.ajax.method,headers:{"Content-Type":"application/json",...this.config.ajax.headers},signal:n.signal},r=setTimeout((()=>{n.abort()}),this.config.ajax.timeout);"GET"!==this.config.ajax.method&&(s.body=JSON.stringify(i));const a="GET"===this.config.ajax.method?`${this.config.ajax.url}?${new URLSearchParams(this.flattenObject(i))}`:this.config.ajax.url,o=await fetch(a,s);if(clearTimeout(r),!o.ok)throw new Error(`HTTP error! status: ${o.status} - ${o.statusText}`);const l=await o.json(),c=this.getNestedValue(l,this.config.serverResponse.draw);if(c&&c!==e)return void console.warn("Response draw ID mismatch, ignoring stale response");const h=this.getNestedValue(l,this.config.serverResponse.data),d=this.getNestedValue(l,this.config.serverResponse.totalRecords),g=this.getNestedValue(l,this.config.serverResponse.error);if(g)throw new Error(g);if(!Array.isArray(h))throw new Error("Server response data is not an array");this.originalData=[...h],this.filteredData=[...h],this.totalRecords="number"==typeof d?d:h.length,this.retryCount=0,console.log("Server data loaded:",{dataLength:h.length,totalRecords:this.totalRecords,currentPage:this.currentPage,pageSize:this.config.pageSize}),this.render(),this.emit(EVENTS.SERVER_DATA_LOADED,{data:h,total:this.totalRecords,page:this.currentPage,search:this.searchTerm,sort:this.sortColumn,direction:this.sortDirection})}catch(e){if("AbortError"===e.name)return void console.log("Request was cancelled");if(console.error("Failed to load server data:",e),this.retryCount<this.config.ajax.retryAttempts)return this.retryCount++,console.log(`Retrying request (${this.retryCount}/${this.config.ajax.retryAttempts})...`),void setTimeout((()=>{this.loadServerData()}),this.config.ajax.retryDelay*this.retryCount);this.config.ajax.error&&"function"==typeof this.config.ajax.error&&this.config.ajax.error(e,this.currentPage,this.searchTerm),this.emit(EVENTS.SERVER_ERROR,{error:e.message,page:this.currentPage,search:this.searchTerm,sort:this.sortColumn,direction:this.sortDirection})}finally{this.isLoading=!1,this.hideLoading(),this.currentRequest=null,this.config.ajax.complete&&"function"==typeof this.config.ajax.complete&&this.config.ajax.complete(),this.emit(EVENTS.SERVER_REQUEST_END,{page:this.currentPage,search:this.searchTerm,sort:this.sortColumn,direction:this.sortDirection})}}}else console.error("Server-side processing enabled but no URL provided")}getNestedValue(e,t){return t&&e?t.split(".").reduce(((e,t)=>e&&void 0!==e[t]?e[t]:null),e):e}flattenObject(e,t=""){const i={};for(const n in e)if(e.hasOwnProperty(n)){const s=e[n],r=t?`${t}.${n}`:n;null===s||"object"!=typeof s||Array.isArray(s)?i[r]=s:Object.assign(i,this.flattenObject(s,r))}return i}async refresh(){return this.config.serverSide?await this.loadServerData():(this.applyFilters(),this.render()),this}exportData(e,t={}){const i={...this.config.exportOptions,...t},n=this.getExportData(i);switch(e.toLowerCase()){case EXPORT_FORMATS.CSV:this.exportToCSV(n,i);break;case EXPORT_FORMATS.EXCEL:this.exportToExcel(n,i);break;case EXPORT_FORMATS.PDF:this.exportToPDF(n,i);break;case EXPORT_FORMATS.PRINT:this.printTable(n,i);break;default:return console.warn(`Unsupported export format: ${e}`),this}return this.emit(EVENTS.EXPORT,{format:e,options:i,data:n}),this}getExportData(e){let t;if(e.selectedOnly&&this.selectedRows.size>0)t=Array.from(this.selectedRows).map((e=>this.filteredData[e])).filter(Boolean);else if(e.visibleOnly){const e=(this.currentPage-1)*this.config.pageSize,i=e+this.config.pageSize;t=this.filteredData.slice(e,i)}else t=[...this.filteredData];return t}exportToCSV(e,t){const i=t.csvSeparator||",",n=this.config.columns.map((e=>e.title)),s=e.map((e=>this.config.columns.map((n=>{let s=this.getCellValue(e,n.key);return"date"===n.type&&s?s=this.formatDateForExport(s,t.dateFormat):"currency"===n.type&&null!=s&&(s=parseFloat(s)||0),s=String(s||""),(s.includes(i)||s.includes('"')||s.includes("\n"))&&(s=`"${s.replace(/"/g,'""')}"`),s}))));let r="";t.includeHeaders&&(r+=n.join(i)+"\n"),r+=s.map((e=>e.join(i))).join("\n"),this.downloadFile(r,`${t.filename}.csv`,"text/csv")}exportToExcel(e,t){const i=this.config.columns.map((e=>e.title)),n=e.map((e=>this.config.columns.map((i=>{let n=this.getCellValue(e,i.key);return"date"===i.type&&n?n=this.formatDateForExport(n,t.dateFormat):"currency"===i.type&&null!=n&&(n=parseFloat(n)||0),n||""}))));let s=`\n            <html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">\n            <head>\n                <meta charset="utf-8">\n                <meta name="ProgId" content="Excel.Sheet">\n                <meta name="Generator" content="QMGrid">\n                \x3c!--[if gte mso 9]>\n                <xml>\n                    <x:ExcelWorkbook>\n                        <x:ExcelWorksheets>\n                            <x:ExcelWorksheet>\n                                <x:Name>${t.excelSheetName}</x:Name>\n                                <x:WorksheetOptions>\n                                    <x:DisplayGridlines/>\n                                </x:WorksheetOptions>\n                            </x:ExcelWorksheet>\n                        </x:ExcelWorksheets>\n                    </x:ExcelWorkbook>\n                </xml>\n                <![endif]--\x3e\n                <style>\n                    table { border-collapse: collapse; width: 100%; }\n                    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n                    th { background-color: #f2f2f2; font-weight: bold; }\n                </style>\n            </head>\n            <body>\n                <table>`;t.includeHeaders&&(s+="<thead><tr>",i.forEach((e=>{s+=`<th>${this.escapeHtml(e)}</th>`})),s+="</tr></thead>"),s+="<tbody>",n.forEach((e=>{s+="<tr>",e.forEach((e=>{s+=`<td>${this.escapeHtml(String(e))}</td>`})),s+="</tr>"})),s+="</tbody></table></body></html>",this.downloadFile(s,`${t.filename}.xls`,"application/vnd.ms-excel")}exportToPDF(e,t){const i=this.config.columns.map((e=>e.title)),n=e.map((e=>this.config.columns.map((i=>{let n=this.getCellValue(e,i.key);return"date"===i.type&&n?n=this.formatDateForExport(n,t.dateFormat):"currency"===i.type&&null!=n&&(n=parseFloat(n)||0),this.escapeHtml(String(n||""))})))),s=window.open("","_blank");let r=`\n            <!DOCTYPE html>\n            <html>\n            <head>\n                <meta charset="utf-8">\n                <title>${t.filename}</title>\n                <style>\n                    @page {\n                        size: ${t.pdfPageSize} ${t.pdfOrientation};\n                        margin: 1cm;\n                    }\n                    body {\n                        font-family: Arial, sans-serif;\n                        font-size: 12px;\n                        margin: 0;\n                        padding: 0;\n                    }\n                    h1 {\n                        text-align: center;\n                        margin-bottom: 20px;\n                        font-size: 18px;\n                    }\n                    table {\n                        width: 100%;\n                        border-collapse: collapse;\n                        margin: 0 auto;\n                    }\n                    th, td {\n                        border: 1px solid #ddd;\n                        padding: 8px;\n                        text-align: left;\n                        word-wrap: break-word;\n                    }\n                    th {\n                        background-color: #f2f2f2;\n                        font-weight: bold;\n                    }\n                    tr:nth-child(even) {\n                        background-color: #f9f9f9;\n                    }\n                    @media print {\n                        body { print-color-adjust: exact; }\n                        table { page-break-inside: auto; }\n                        tr { page-break-inside: avoid; page-break-after: auto; }\n                        th { page-break-after: avoid; }\n                    }\n                </style>\n            </head>\n            <body>\n                <h1>${t.filename}</h1>\n                <table>`;t.includeHeaders&&(r+="<thead><tr>",i.forEach((e=>{r+=`<th>${e}</th>`})),r+="</tr></thead>"),r+="<tbody>",n.forEach((e=>{r+="<tr>",e.forEach((e=>{r+=`<td>${e}</td>`})),r+="</tr>"})),r+="\n                </tbody>\n                </table>\n                <script>\n                    window.onload = function() {\n                        window.print();\n                        setTimeout(() => window.close(), 1000);\n                    };\n                <\/script>\n            </body>\n            </html>",s.document.write(r),s.document.close()}printTable(e,t){const i=this.config.columns.map((e=>e.title)),n=e.map((e=>this.config.columns.map((i=>{let n=this.getCellValue(e,i.key);return"date"===i.type&&n?n=this.formatDateForExport(n,t.dateFormat):"currency"===i.type&&null!=n&&(n=parseFloat(n)||0),this.escapeHtml(String(n||""))})))),s=window.open("","_blank");let r=`\n            <!DOCTYPE html>\n            <html>\n            <head>\n                <meta charset="utf-8">\n                <title>Print - ${t.filename}</title>\n                <style>\n                    body {\n                        font-family: Arial, sans-serif;\n                        margin: 20px;\n                        font-size: 12px;\n                    }\n                    h1 {\n                        text-align: center;\n                        margin-bottom: 20px;\n                        color: #333;\n                    }\n                    table {\n                        width: 100%;\n                        border-collapse: collapse;\n                        margin: 0 auto;\n                    }\n                    th, td {\n                        border: 1px solid #ddd;\n                        padding: 8px;\n                        text-align: left;\n                    }\n                    th {\n                        background-color: #f2f2f2;\n                        font-weight: bold;\n                    }\n                    tr:nth-child(even) {\n                        background-color: #f9f9f9;\n                    }\n                    @media print {\n                        body { margin: 0; }\n                        table { page-break-inside: auto; }\n                        tr { page-break-inside: avoid; page-break-after: auto; }\n                        th { page-break-after: avoid; }\n                    }\n                </style>\n            </head>\n            <body>\n                <h1>${t.filename}</h1>\n                <table>`;t.includeHeaders&&(r+="<thead><tr>",i.forEach((e=>{r+=`<th>${e}</th>`})),r+="</tr></thead>"),r+="<tbody>",n.forEach((e=>{r+="<tr>",e.forEach((e=>{r+=`<td>${e}</td>`})),r+="</tr>"})),r+="\n                </tbody>\n                </table>\n                <script>\n                    window.onload = function() {\n                        window.print();\n                    };\n                <\/script>\n            </body>\n            </html>",s.document.write(r),s.document.close()}downloadFile(e,t,i){const n=new Blob([e],{type:i}),s=window.URL.createObjectURL(n),r=document.createElement("a");r.href=s,r.download=t,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(s)}formatDateForExport(e,t){try{const i=new Date(e);if(isNaN(i.getTime()))return String(e);const n=i.getFullYear(),s=String(i.getMonth()+1).padStart(2,"0"),r=String(i.getDate()).padStart(2,"0");switch(t){case"YYYY-MM-DD":return`${n}-${s}-${r}`;case"MM/DD/YYYY":return`${s}/${r}/${n}`;case"DD/MM/YYYY":return`${r}/${s}/${n}`;default:return i.toLocaleDateString()}}catch(t){return String(e)}}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}on(e,t){this.events||(this.events={}),this.events[e]||(this.events[e]=[]),this.events[e].push(t)}off(e,t){this.events&&this.events[e]&&(this.events[e]=this.events[e].filter((e=>e!==t)))}emit(e,t){this.events&&this.events[e]&&this.events[e].forEach((e=>e(t)))}destroy(){this.currentRequest&&(this.currentRequest.abort(),this.currentRequest=null),this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null),this.eventListeners.forEach((({element:e,event:t,handler:i})=>{e&&e.removeEventListener&&e.removeEventListener(t,i)})),this.eventListeners.clear(),this.originalData=[],this.filteredData=[],this.selectedRows.clear(),this.events={},this.isLoading=!1,this.totalRecords=0,this.retryCount=0,this.container&&(this.container.innerHTML="",this.container.className=this.container.className.replace(/qmgrid-container/g,"").trim()),this.container=null,this.config=null}}"undefined"!=typeof module&&module.exports?module.exports=QMGrid:"function"==typeof define&&define.amd?define([],(function(){return QMGrid})):window.QMGrid=QMGrid;
//# sourceMappingURL=/sm/daa662da00038d63faacd3fb7c6bcd03943ad307e8dc6755931db0de6d55f146.map